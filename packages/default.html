<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta charset="utf-8"/>
    <title>     &raquo; \Default
</title>
    <meta name="author" content=""/>
    <meta name="description" content=""/>

            <link href="../css/template.css" rel="stylesheet" media="all"/>
    
            <!--[if lt IE 9]>
        <script src="https://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
        <![endif]-->
        <script src="../js/jquery-1.7.1.min.js" type="text/javascript"></script>
        <script src="../js/jquery-ui-1.8.2.custom.min.js" type="text/javascript"></script>
        <script src="../js/jquery.mousewheel.min.js" type="text/javascript"></script>
        <script src="../js/bootstrap.js" type="text/javascript"></script>
        <script src="../js/template.js" type="text/javascript"></script>
        <script src="../js/prettify/prettify.min.js" type="text/javascript"></script>
    
            <link rel="shortcut icon" href="../img/favicon.ico"/>
        <link rel="apple-touch-icon" href="../img/apple-touch-icon.png"/>
        <link rel="apple-touch-icon" sizes="72x72" href="../img/apple-touch-icon-72x72.png"/>
        <link rel="apple-touch-icon" sizes="114x114" href="../img/apple-touch-icon-114x114.png"/>
    </head>
<body>

        <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span> <span class="icon-bar"></span>
                    <span class="icon-bar"></span> </a>
                <a class="brand" href="../index.html">Satori RTM PHP SDK</a>

                <div class="nav-collapse">
                    <ul class="nav">
                        <li class="dropdown">
                            <a href="#api" class="dropdown-toggle" data-toggle="dropdown">
                                API Documentation <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                                                    <li><a>Namespaces</a></li>
                                                                        <li><a href="../namespaces/RtmClient.html">RtmClient</a></li>
                                                                                                                                </ul>
                        </li>
                        <li class="dropdown" id="charts-menu">
                            <a href="#charts" class="dropdown-toggle" data-toggle="dropdown">
                                Charts <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="../graph_class.html">
                                        <i class="icon-list-alt"></i>&#160;Class hierarchy diagram
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="dropdown" id="reports-menu">
                            <a href="#reports" class="dropdown-toggle" data-toggle="dropdown">
                                Reports <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="../errors.html">
                                        <i class="icon-list-alt"></i>&#160;Errors
                                    </a>
                                </li>
                                <li>
                                    <a href="../markers.html">
                                        <i class="icon-list-alt"></i>&#160;Markers
                                    </a>
                                </li>
                                <li>
                                    <a href="../deprecated.html">
                                        <i class="icon-list-alt"></i>&#160;Deprecated
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="go_to_top">
            <a href="#___" style="color: inherit">Back to top&#160;&#160;<i class="icon-upload icon-white"></i></a>
        </div>
    </div>
    
    <div id="___" class="container">
        <noscript>
            <div class="alert alert-warning">
                Javascript is disabled; several features are only available if Javascript is enabled.
            </div>
        </noscript>

        
            
    <div class="row">

        <div class="span4">
            <div class="btn-group view pull-right" data-toggle="buttons-radio">
                <button class="btn details" title="Show descriptions and method names">
                    <i class="icon-list"></i></button><button class="btn simple" title="Show only method names">
                    <i class="icon-align-justify"></i>
                </button>
            </div>
            <ul class="side-nav nav nav-list">
                <li class="nav-header">
                    <i class="icon-map-marker"></i> Packages
                </li>
                <a href="../packages/Default.html" title="Default">
                    <i class="icon-th"></i> Default
                </a>
                <ul class="nav nav-list nav-packages">
                        
    
                </ul>
            </ul>
        </div>

        <div class="span8 package-contents">
                
    <ul class="breadcrumb">
        <li><a href="../index.html"><i class="icon-th"></i></a></li>
            
    
    <li>
        <span class="divider">\</span><a href="../packages/Default.html">Default</a>
    </li>

    </ul>

    
        
                    <div class="package-indent">
                <h3><i class="icon-custom icon-constant"></i> Constants</h3>
                                        <div id="BASE_DIR" class="element ajax clickable constant">
        <h1>BASE_DIR<a href="../namespaces/default.html#constant_BASE_DIR">¶</a></h1>
        <p class="short_description"></p>
        <div class="details collapse"></div>
        <a href="../namespaces/default.html#constant_BASE_DIR" class="more">« More »</a>
    </div>

                            </div>
        
                    <div class="package-indent">
                <h3><i class="icon-custom icon-class"></i> Classes, interfaces and traits</h3>
                
                                        <div id="iAuth" class="element ajax clickable interface">
        <h1>iAuth<a href="../classes/RtmClient.Auth.iAuth.html">¶</a></h1>
        <p class="short_description">Authentication interface.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Auth.iAuth.html" class="more">« More »</a>
    </div>

                
                                        <div id="ApplicationException" class="element ajax clickable class">
        <h1>ApplicationException<a href="../classes/RtmClient.Exceptions.ApplicationException.html">¶</a></h1>
        <p class="short_description">Application issues exception.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Exceptions.ApplicationException.html" class="more">« More »</a>
    </div>

                                        <div id="AuthenticationException" class="element ajax clickable class">
        <h1>AuthenticationException<a href="../classes/RtmClient.Exceptions.AuthenticationException.html">¶</a></h1>
        <p class="short_description">Auth errors exception.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Exceptions.AuthenticationException.html" class="more">« More »</a>
    </div>

                                        <div id="BadSchemeException" class="element ajax clickable class">
        <h1>BadSchemeException<a href="../classes/RtmClient.WebSocket.Exceptions.BadSchemeException.html">¶</a></h1>
        <p class="short_description">URL bad schema exception.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.WebSocket.Exceptions.BadSchemeException.html" class="more">« More »</a>
    </div>

                                        <div id="Client" class="element ajax clickable class">
        <h1>Client<a href="../classes/RtmClient.WebSocket.Client.html">¶</a></h1>
        <p class="short_description">WebSocket client implementation.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.WebSocket.Client.html" class="more">« More »</a>
    </div>

                                        <div id="Connection" class="element ajax clickable class">
        <h1>Connection<a href="../classes/RtmClient.Connection.html">¶</a></h1>
        <p class="short_description">Satori RTM Connection.</p>
        <div class="details collapse">Access the RTM Service on the connection level to connect to the RTM Service, send and receive PDUs
Uses WebSocket client to connect to RTM.

Does not handle any possible exceptions from the WS client.</div>
        <a href="../classes/RtmClient.Connection.html" class="more">« More »</a>
    </div>

                                        <div id="ConnectionException" class="element ajax clickable class">
        <h1>ConnectionException<a href="../classes/RtmClient.WebSocket.Exceptions.ConnectionException.html">¶</a></h1>
        <p class="short_description">All connection issues exception.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.WebSocket.Exceptions.ConnectionException.html" class="more">« More »</a>
    </div>

                                        <div id="Events" class="element ajax clickable class">
        <h1>Events<a href="../classes/RtmClient.Subscription.Events.html">¶</a></h1>
        <p class="short_description">Subscription events list.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Subscription.Events.html" class="more">« More »</a>
    </div>

                                        <div id="Helper" class="element ajax clickable class">
        <h1>Helper<a href="../classes/RtmClient.Pdu.Helper.html">¶</a></h1>
        <p class="short_description">Helper functions to work with PDU.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Pdu.Helper.html" class="more">« More »</a>
    </div>

                                        <div id="Logger" class="element ajax clickable class">
        <h1>Logger<a href="../classes/RtmClient.Logger.Logger.html">¶</a></h1>
        <p class="short_description">PSR-3 Logger.</p>
        <div class="details collapse">https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-3-logger-interface.md</div>
        <a href="../classes/RtmClient.Logger.Logger.html" class="more">« More »</a>
    </div>

                                        <div id="LogLevel" class="element ajax clickable class">
        <h1>LogLevel<a href="../classes/RtmClient.Logger.LogLevel.html">¶</a></h1>
        <p class="short_description">Default PSR-3 LogLevels.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Logger.LogLevel.html" class="more">« More »</a>
    </div>

                                        <div id="Observable" class="element ajax clickable class">
        <h1>Observable<a href="../classes/RtmClient.Observable.html">¶</a></h1>
        <p class="short_description">Observable class.</p>
        <div class="details collapse">Allows to extend any struct with ability to Fire events and ability
to listen for any events.</div>
        <a href="../classes/RtmClient.Observable.html" class="more">« More »</a>
    </div>

                                        <div id="OpCode" class="element ajax clickable class">
        <h1>OpCode<a href="../classes/RtmClient.WebSocket.OpCode.html">¶</a></h1>
        <p class="short_description">Frame opcode.</p>
        <div class="details collapse">https://tools.ietf.org/html/rfc6455</div>
        <a href="../classes/RtmClient.WebSocket.OpCode.html" class="more">« More »</a>
    </div>

                                        <div id="Pdu" class="element ajax clickable class">
        <h1>Pdu<a href="../classes/RtmClient.Pdu.Pdu.html">¶</a></h1>
        <p class="short_description">Protocol Data Unit (PDU).</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Pdu.Pdu.html" class="more">« More »</a>
    </div>

                                        <div id="ReturnCode" class="element ajax clickable class">
        <h1>ReturnCode<a href="../classes/RtmClient.WebSocket.ReturnCode.html">¶</a></h1>
        <p class="short_description">List of possible result of read and write operations.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.WebSocket.ReturnCode.html" class="more">« More »</a>
    </div>

                                        <div id="ReturnCode" class="element ajax clickable class">
        <h1>ReturnCode<a href="../classes/RtmClient.Pdu.ReturnCode.html">¶</a></h1>
        <p class="short_description">Code number representation.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Pdu.ReturnCode.html" class="more">« More »</a>
    </div>

                                        <div id="RoleAuth" class="element ajax clickable class">
        <h1>RoleAuth<a href="../classes/RtmClient.Auth.RoleAuth.html">¶</a></h1>
        <p class="short_description">RTM role-based authentication.</p>
        <div class="details collapse">Client connection to RTM is established in default role.
Client can acquire different the permissions by authenticating for a different role.
This is done in a two-step process using the Handshake and then Authenticate PDU.</div>
        <a href="../classes/RtmClient.Auth.RoleAuth.html" class="more">« More »</a>
    </div>

                                        <div id="RtmClient" class="element ajax clickable class">
        <h1>RtmClient<a href="../classes/RtmClient.RtmClient.html">¶</a></h1>
        <p class="short_description">RTM client.</p>
        <div class="details collapse">The **RtmClient** class is the main entry point to manage the
WebSocket connection from the PHP SDK to RTM.

Use the RtmClient class to create a client instance from which you can
publish messages and subscribe to channels, create separate
Subscription objects for each channel to which you want to subscribe.

RtmClient has a **single-threaded** model.
This model imposes some limitations:
 - You cannot read from a WebSocket connection and write to it in the same time;
 - You **MUST TO** read from a WebSocket connection from time to time to avoid buffer overflowing;


Events
=============================================
RTM Client allows to use Event-Based model for Events.
Use client.on&amp;lt;Event&amp;gt; function to continuously processing events.

Base syntax: `$client-&gt;onEvent($callback_function);`

Example:
```php
&lt;?php
$client = new RtmClient(ENDPOINT, APP_KEY);
$client-&gt;onConnected(function () {
    echo &#039;Connected to Satori RTM and authenticated as &#039; . ROLE . PHP_EOL;
})-&gt;onError(function ($type, $error) {
    echo &quot;Type: $type; Error: $error[message] ($error[code])&quot; . PHP_EOL;
});
$client-&gt;connect();
```


Each event handler returns $client object, so you can register callbacks continuously.


You can register multiple callbacks on the same event:
```php
$client = new RtmClient(ENDPOINT, APP_KEY);
$client-&gt;onConnected(function () {
     echo &#039;Callback 1&#039;;
});
$client-&gt;onConnected(function () {
     echo &#039;Callback 2&#039;;
});
$client-&gt;connect();
```

There are 4 base events:
 - CONNECTED     occurs when client is connected to the endpoint
 - DISCONNECTED  occurs when client lost connection
 - AUTHENTICATED occurs after successfull authentication
 - ERROR         occurs on each error

Event Parametes
------------------------------------------------

**onConnected()**
 - not passed

**onDisconnected($code, $message)**
 - int $code TCP socket error codes or internal application code
 - string $message Disconnect reason

**onAuthenticated()**
 - not passed

**onError($type, $error)**
 - ERROR_TYPE_APPLICATION|ERROR_TYPE_CONNECTION|ERROR_TYPE_AUTHENTICATION $type Error type
 - array $error Error details. Keys:
   - int $code Error code
   - string $message Error description


Authentication
=============================================

You can specify role to get role-based permissions (E.g. get an access to
Subscribe/Publish to some channels) when connecting to the endpoint.
Follow the link to get more information: https://www.satori.com/docs/using-satori/authentication

Use [\RtmClient\Auth\RoleAuth](../classes/RtmClient.Auth.RoleAuth.html) to authenticate using role-based authentication:
```php
$options = array(
    &#039;auth&#039; =&gt; new RtmClient\Auth\RoleAuth(ROLE, ROLE_SECRET_KEY),
);
$client = new RtmClient(ENDPOINT, APP_KEY, $options);
```

Subscriptions
=============================================

RTM client allows to subscribe to channels:
```
$client-&gt;subscribe(&#039;animals&#039;, function ($ctx, $type, $data) {
     print_r($data);
});
```

Check the [\RtmClient\Subscription\Subscription](../classes/RtmClient.Subscription.Subscription.html) class to get more information
about the possible options.

A subscription callback is called when the following subscription events occur:
```
SUBSCRIBED - after getting confirmation from Satori RTM about subscription
UNSUBSCRIBED - after successful unsubscribing
DATA - when getting rtm/subscription/data from Satori RTM
INFO - when getting rtm/subscription/info message
ERROR - on every rtm/subscription/error or rtm/subscribe/error
```

You should specify callback when creating a new subscription. Example:
```
use RtmClient\Subscription\Events;

$callback = function ($ctx, $type, $data) {
    switch ($type) {
        case Events::SUBSCRIBED:
            echo &#039;Subscribed to: &#039; . $ctx[&#039;subscription&#039;]-&gt;getSubscriptionId() . PHP_EOL;
            break;
        case Events::UNSUBSCRIBED:
            echo &#039;Unsubscribed from: &#039; . $ctx[&#039;subscription&#039;]-&gt;getSubscriptionId() . PHP_EOL;
            break;
        case Events::DATA:
            foreach ($data[&#039;messages&#039;] as $message) {
                if (isset($message[&#039;who&#039;]) &amp;&amp; isset($message[&#039;where&#039;])) {
                    echo &#039;Got animal &#039; . $message[&#039;who&#039;] . &#039;: &#039; . json_encode($message[&#039;where&#039;]) . PHP_EOL;
                } else {
                    echo &#039;Got message: &#039; . json_encode($message) . PHP_EOL;
                }
            }
            break;
        case Events::ERROR:
            echo &#039;Subscription failed. &#039; . $err[&#039;error&#039;] . &#039;: &#039; . $err[&#039;reason&#039;] . PHP_EOL;
            break;
    }
};
$subscription = $client-&gt;subscribe(&#039;animals&#039;, $callback, array(
    &#039;filter&#039; =&gt; &quot;SELECT * FROM `animals` WHERE who = &#039;zebra&#039;&quot;,
));
```

Read/Write workflow
=============================================

Because of RtmClient has a **single-threaded** model you should alternate read and write operations

Simple publish with ack example. We publish message and require acknowledge from
Sator RTM:
```
$client = new RtmClient(ENDPOINT, APP_KEY);
$client-&gt;publish(CHANNEL, &#039;test message&#039;, function ($ack) {
     echo &#039;Got ack from Satori RTM&#039;;
});
$client-&gt;tcpReadSync(); // Wait for reply from Satori RTM
```

In case if you do not want to wait too much time on reading use **timeout**:
```
$client = new RtmClient(ENDPOINT, APP_KEY);
$client-&gt;publish(CHANNEL, &#039;test message&#039;, function ($ack) {
     echo &#039;Got ack from Satori RTM&#039;;
});
$client-&gt;tcpReadSync(2); // Wait for incoming message for 2 seconds only
```

If you await multiple replies use [\RtmClient\RtmClient::waitAllReplies()](../classes/RtmClient.RtmClient.html#method_waitAllReplies)
```
$client = new RtmClient(ENDPOINT, APP_KEY);
$client-&gt;publish(CHANNEL, &#039;message&#039;, function ($ack) {
     echo &#039;Got ack 1 from Satori RTM&#039;;
});
$client-&gt;publish(CHANNEL, &#039;message-2&#039;, function ($ack) {
     echo &#039;Got ack 2 from Satori RTM&#039;;
});
$client-&gt;read(CHANNEL, function ($data) {
     echo &#039;Got read data from Satori RTM&#039;;
});
$client-&gt;waitAllReplies(); // Also you can specify wait timeout in seconds
echo &#039;Done!&#039;;

// Output:
// Got ack 1 from Satori RTM
// Got ack 2 from Satori RTM
// Got read data from Satori RTM
// Done!
```

Also there is an **Async mode**. Reading in this mode means, that you will not be
blocked if there are no incoming messages in socket:
```
use RtmClient\WebSocket\ReturnCode as RC;

$client = new RtmClient(ENDPOINT, APP_KEY);
$client-&gt;publish(CHANNEL, &#039;test message&#039;, function ($ack) {
     echo &#039;Got ack from Satori RTM&#039;;
});
$code = $client-&gt;tcpReadAsync();
switch ($code) {
 case RC::READ_OK:
     echo &#039;Read incoming message&#039;;
     break;
 case RC::READ_WOULD_BLOCK:
     echo &#039;There are no messages in socket at this moment&#039;;
     break;
 default:
     echo &#039;Another return code&#039;;
}
```

If you subscribe to the channels and want to publish messages in the same time you can
use tcpReadAsync or Async helpers: [\RtmClient\RtmClient::sockReadIncoming()](../classes/RtmClient.RtmClient.html#method_sockReadIncoming) or [\RtmClient\RtmClient::sockReadFor()](../classes/RtmClient.RtmClient.html#method_sockReadFor)
```
$messages_count = 0;
$client = new RtmClient(ENDPOINT, APP_KEY);
$client-&gt;subscribe(CHANNEL, function ($ctx, $type, $data) use (&amp;$messages_count) {
    if ($type == Events::DATA) {
        foreach ($data[&#039;messages&#039;] as $message) {
            echo &#039;Got message: &#039; . json_encode($message) . PHP_EOL;
            $messages_count++;
        }
    }
});

while (true) {
     $client-&gt;sockReadFor(2); // Read possible messages for 2 seconds
     $client-&gt;publish(ANOTHER_CHANNEL, time(), function() {
         echo &#039;Sent time&#039; . PHP_EOL;
     });
     $client-&gt;publish(MY_STAT_CHANNEL, $messages_count, function() {
         echo &#039;Sent messages count&#039; . PHP_EOL;
     });
}
```

Reconnects
=============================================

An RtmClient instance is a one-time connection. It means that you cannot continue using
client after connection is dropped.

To make a new connection to Satori RTM you can clone previous client:
```
$new_client = clone $old_client;
$new_client-&gt;connect();
```

All your callbacks will be moved to the new client. After calling `connect`
client will establish a new connection to Satori RTM.
Note that you need to restore your subscriptions manually.

See *reconnects* examples.</div>
        <a href="../classes/RtmClient.RtmClient.html" class="more">« More »</a>
    </div>

                                        <div id="RtmEvents" class="element ajax clickable class">
        <h1>RtmEvents<a href="../classes/RtmClient.RtmEvents.html">¶</a></h1>
        <p class="short_description">RTM events list.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.RtmEvents.html" class="more">« More »</a>
    </div>

                                        <div id="Subscription" class="element ajax clickable class">
        <h1>Subscription<a href="../classes/RtmClient.Subscription.Subscription.html">¶</a></h1>
        <p class="short_description">RTM Subscription model.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.Subscription.Subscription.html" class="more">« More »</a>
    </div>

                                        <div id="TimeoutException" class="element ajax clickable class">
        <h1>TimeoutException<a href="../classes/RtmClient.WebSocket.Exceptions.TimeoutException.html">¶</a></h1>
        <p class="short_description">Socket read timeout exception.</p>
        <div class="details collapse"></div>
        <a href="../classes/RtmClient.WebSocket.Exceptions.TimeoutException.html" class="more">« More »</a>
    </div>

                            </div>
            
    
        </div>
    </div>
    </div>

        <footer class="span12">
            Template is built using <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap 2</a> and icons provided by
            <a href="http://glyphicons.com/">Glyphicons</a>.<br/>
            Documentation is powered by <a href="http://www.phpdoc.org/">phpDocumentor </a> and<br/>
            generated on Wed, 11 Oct 2017 04:56:48 -0700.<br/>
    </footer>
    </body>
</html>
